<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Norfside Veil Decipherer</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'VT323', monospace;
            background-color: #000;
            color: #54e167;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }
        .tablet-frame {
            background-color: #222;
            border: 10px solid #333;
            border-radius: 30px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.7);
            width: 95%;
            height: 95%;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .terminal-frame {
            background-color: #333;
            border: 2px solid orange;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        .terminal-header {
            background-color: #222;
            padding: 10px;
            border-bottom: 2px solid orange;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: orange;
        }
        .terminal-header .title {
            font-size: 1.5em;
        }
        .terminal-header .buttons {
            display: flex;
            gap: 10px;
        }
        .terminal-header .button {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background-color: orange;
        }
        .terminal {
            background: repeating-linear-gradient(
                0deg,
                #062f1d,
                #062f1d 2px,
                #042516 2px,
                #042516 4px
            );
            padding: 20px;
            flex-grow: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        .terminal div {
            font-size: 1.5vw;
            min-height: 20px;
            line-height: 1.5;
        }
        .input-line {
            display: flex;
            align-items: center;
        }
        .prompt {
            color: #54e167;
            margin-right: 8px;
        }
        .terminal input {
            font-family: 'VT323', monospace;
            font-size: 1.5vw;
            background: transparent;
            border: none;
            color: #54e167;
            flex-grow: 1;
            outline: none;
            padding: 0;
            margin: 0;
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
        .cursor {
            display: inline-block;
            width: 8px;
            height: 1.5vw;
            background-color: #54e167;
            margin-left: 2px;
            animation: blink 1s infinite;
            vertical-align: middle;
        }
        @keyframes flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }
        .flicker {
            animation: flicker 0.15s infinite;
        }
        #output {
            flex-grow: 1;
            overflow-y: auto;
        }
        #main-terminal {
            display: none;
            flex-grow: 1;
            flex-direction: column;
        }
    </style>
</head>
<body>
    <div class="tablet-frame">
        <div class="terminal-frame">
            <div class="terminal-header">
                <div class="title">Cypress Terminal</div>
                <div class="buttons">
                    <div class="button"></div>
                    <div class="button"></div>
                    <div class="button"></div>
                </div>
            </div>
            <div class="terminal" id="terminal"></div>
            <div class="terminal" id="main-terminal">
                <div id="output"></div>
                <div class="input-line">
                    <span class="prompt">></span>
                    <input type="text" id="input" autofocus>
                    <span class="cursor"></span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const lines = [
            'NC -V CYPRESS-DECODING.COM 420',
            'CONNECTING TO CYPRESS-DECODING:420.',
            'INITIATING SSL HANDSHAKE...'
        ];

        function fibonacciSequence(n) {
            const fib = [0, 1];
            while (fib.length < n) {
                fib.push(fib[fib.length - 1] + fib[fib.length - 2]);
            }
            return fib.slice(0, n);
        }

        function shiftLetterFibonacci(letter, shiftAmount) {
            if (letter.match(/[a-z]/i)) {
                const base = letter.toLowerCase().charCodeAt(0) - 97;
                return String.fromCharCode(((base + shiftAmount) % 26) + 97);
            }
            return letter;
        }

        function shiftLetterFibonacciReverse(letter, shiftAmount) {
            if (letter.match(/[a-z]/i)) {
                const base = letter.toLowerCase().charCodeAt(0) - 97;
                return String.fromCharCode(((base - shiftAmount + 26) % 26) + 97);
            }
            return letter;
        }

        function substituteAlphabet(plaintext, substitutionKey) {
            const standardAlphabet = 'abcdefghijklmnopqrstuvwxyz';
            let substitutionAlphabet = Array.from(new Set(substitutionKey.toLowerCase())).join('');
            substitutionAlphabet += standardAlphabet.split('').filter(c => !substitutionAlphabet.includes(c)).join('');
            const substitutionMap = new Map(standardAlphabet.split('').map((c, i) => [c, substitutionAlphabet[i]]));
            return plaintext.split('').map(c => substitutionMap.get(c.toLowerCase()) || c).join('');
        }

        function reverseSubstituteAlphabet(ciphertext, substitutionKey) {
            const standardAlphabet = 'abcdefghijklmnopqrstuvwxyz';
            let substitutionAlphabet = Array.from(new Set(substitutionKey.toLowerCase())).join('');
            substitutionAlphabet += standardAlphabet.split('').filter(c => !substitutionAlphabet.includes(c)).join('');
            const reverseSubstitutionMap = new Map(substitutionAlphabet.split('').map((c, i) => [c, standardAlphabet[i]]));
            return ciphertext.split('').map(c => reverseSubstitutionMap.get(c.toLowerCase()) || c).join('');
        }

        function dynamicSeedShift(text, shiftAmount) {
            const standardAlphabet = 'abcdefghijklmnopqrstuvwxyz';
            const shiftedAlphabet = standardAlphabet.slice(shiftAmount) + standardAlphabet.slice(0, shiftAmount);
            const shiftMap = new Map(standardAlphabet.split('').map((c, i) => [c, shiftedAlphabet[i]]));
            return text.split('').map(c => shiftMap.get(c.toLowerCase()) || c).join('');
        }

        function reverseDynamicSeedShift(text, shiftAmount) {
            const standardAlphabet = 'abcdefghijklmnopqrstuvwxyz';
            const shiftedAlphabet = standardAlphabet.slice(-shiftAmount) + standardAlphabet.slice(0, -shiftAmount);
            const reverseShiftMap = new Map(standardAlphabet.split('').map((c, i) => [c, shiftedAlphabet[i]]));
            return text.split('').map(c => reverseShiftMap.get(c.toLowerCase()) || c).join('');
        }

        function shadowVeilCipher(plaintext, pk='norfside', ds=13) {
            const fibSequence = fibonacciSequence(plaintext.length);
            const shiftedText = plaintext.split('').map((c, i) => {
                if (c.match(/[a-z]/i)) {
                    return shiftLetterFibonacci(c, fibSequence[i % fibSequence.length] % 26);
                }
                return c;
            }).join('');
            const substitutedText = substituteAlphabet(shiftedText, pk);
            return dynamicSeedShift(substitutedText, ds);
        }

        function shadowVeilDecipher(ciphertext, pk='norfside', ds=13) {
            const reversedShiftText = reverseDynamicSeedShift(ciphertext, ds);
            const reversedSubstitutedText = reverseSubstituteAlphabet(reversedShiftText, pk);
            const fibSequence = fibonacciSequence(reversedSubstitutedText.length);
            return reversedSubstitutedText.split('').map((c, i) => {
                if (c.match(/[a-z]/i)) {
                    return shiftLetterFibonacciReverse(c, fibSequence[i % fibSequence.length] % 26);
                }
                return c;
            }).join('');
        }

        async function typeText(element, text, isLast = false) {
            const lineDiv = document.createElement('div');
            element.appendChild(lineDiv);
            
            const cursor = document.createElement('span');
            cursor.className = 'cursor';
            lineDiv.appendChild(cursor);
            
            for (let i = 0; i < text.length; i++) {
                lineDiv.insertBefore(document.createTextNode(text[i]), cursor);
                await new Promise(resolve => setTimeout(resolve, 50));
            }

            if (!isLast) {
                cursor.remove();
            } else {
                cursor.remove();
            }
        }

        async function displayIntro() {
            const terminal = document.getElementById('terminal');
            
            // Type first line
            await typeText(terminal, lines[0]);
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // Type second line with delay
            await typeText(terminal, lines[1]);
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            // Type third line with delay and cursor
            await typeText(terminal, lines[2], true);
            
            // Wait before switching to main terminal
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            // Switch to main terminal
            terminal.style.display = 'none';
            document.getElementById('main-terminal').style.display = 'flex';
            document.getElementById('input').focus();
            
            // Start the main terminal interface
            await displayOutput('> DO YOU WANT TO CIPHER OR DECIPHER?', true);
        }

        let mode = 'initial';
        let isTyping = false;

        async function displayOutput(text, isLast = false) {
            if (isTyping) return;
            isTyping = true;

            const outputDiv = document.getElementById('output');
            const newLine = document.createElement('div');
            outputDiv.appendChild(newLine);
            
            await typeText(newLine, text, isLast);
            document.querySelector('#main-terminal').scrollTop = document.querySelector('#main-terminal').scrollHeight;
            
            isTyping = false;
            document.getElementById('input').focus();
        }

        function clearOutput() {
            document.getElementById('output').innerHTML = '';
        }

        async function handleInput(event) {
            if (isTyping) return;
            
            const input = document.getElementById('input');

            if (event.key === 'Enter') {
                const value = input.value.trim();
                input.value = '';

                if (mode === 'initial') {
                    if (value.toLowerCase() === 'cipher') {
                        mode = 'cipher';
                        clearOutput();
                        await displayOutput('> ENTER PLAINTEXT TO CIPHER:', true);
                    } else if (value.toLowerCase() === 'decipher') {
                        mode = 'decipher';
                        clearOutput();
                        await displayOutput('> ENTER CIPHERTEXT TO DECIPHER:', true);
                    } else {
                        await displayOutput('> INVALID COMMAND. PLEASE TYPE "CIPHER" OR "DECIPHER".', true);
                    }
                } else if (mode === 'cipher') {
                    await displayOutput('> PROCESSING...');
                    await displayLoadingAnimation();
                    const ciphertext = shadowVeilCipher(value);
                    clearOutput();
                    await displayOutput(`> Ciphertext: ${ciphertext}`, true);
                    mode = 'initial';
                    await displayOutput('> DO YOU WANT TO CIPHER OR DECIPHER?', true);
                } else if (mode === 'decipher') {
                    await displayOutput('> PROCESSING...');
                    await displayLoadingAnimation();
                    const plaintext = shadowVeilDecipher(value);
                    clearOutput();
                    await displayOutput(`> Plaintext: ${plaintext}`, true);
                    mode = 'initial';
                    await displayOutput('> DO YOU WANT TO CIPHER OR DECIPHER?', true);
                }
            }
        }

        async function displayLoadingAnimation() {
            const outputDiv = document.getElementById('output');
            const loadingDiv = document.createElement('div');
            outputDiv.appendChild(loadingDiv);

            const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            const loadingText = 'PROCESSING';
            let loadingString = '';

            for (let i = 0; i < 10; i++) {
                loadingString += characters.charAt(Math.floor(Math.random() * characters.length));
            }

            for (let i = 0; i < 20; i++) {
                loadingDiv.textContent = loadingText + ' ' + loadingString;
                await new Promise(resolve => setTimeout(resolve, 100));
                loadingString = loadingString.slice(1) + characters.charAt(Math.floor(Math.random() * characters.length));
            }

            loadingDiv.remove();
        }

        document.getElementById('input').addEventListener('keydown', handleInput);

        // Start the intro when the page loads
        window.addEventListener('load', displayIntro);
    </script>
</body>
</html>
